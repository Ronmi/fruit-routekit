<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Fruit RouteKit: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Fruit RouteKit
   </div>
   <div id="projectbrief">Route kit of Fruit Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Fruit RouteKit Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This package is part of <a class="el" href="namespace_fruit.html">Fruit</a> Framework.</p>
<p>RouteKit is a fast router implementation. It stores your routing rules in a tree structure, and you can make it even faster by generating a router class with builtin class generator.</p>
<p><a href="https://travis-ci.org/Ronmi/fruit-routekit">![Build Status](https://travis-ci.org/Ronmi/fruit-routekit.svg)</a></p>
<h2>Synopsis</h2>
<p>```php $mux = new <a class="el" href="namespace_fruit.html">Fruit</a>;</p>
<p>// Create routing rules</p>
<p>$mux-&gt;get('/', array('MyClass', 'myMethod')); // static method $mux-&gt;get('/', 'Foo::Bar'); // function $mux-&gt;get('/', 'foobar'); $mux-&gt;get('/', foobar); // create handler/controller instance with constructor arguments. $mux-&gt;get('/foo', array('MyClass', 'myMethod'), array('args', 'of', 'constructor'));</p>
<p>class FOO { public function BAR($arg1, $arg2){} public function BAZ($arg1, $arg2){} } // uri variables are unnamed, ":x" is identical to ":" $mux-&gt;get('/foo/:/:x/bar', array('FOO', 'BAR')); $mux-&gt;get('/foo/:1/baz/:2', array('FOO', 'BAZ'));</p>
<p>// you cannot use closure as handler // $mux-&gt;get('/', function(){}); // wrong!</p>
<p>// but you can use object if it can be serialized with var_export() $mux-&gt;get('/', array(new FOO, 'BAR'));</p>
<p>// dispatch request $mux-&gt;dispatch($_SERVER['REQUEST_METHOD'], $_SERVER['PATH_INFO']);</p>
<p>// generate class file_put_content('router.php', $mux-&gt;compile('MyRouter'));</p>
<p>// use generated router class $mux = require('router.php'); $mux-&gt;dispatch('GET', '/foo/123/abc/bar'); // (new Foo())-&gt;BAR('123', 'abc'); $mux-&gt;dispatch('GET', '/foo'); // (new MyClass('args', 'of', 'constructor'))-&gt;myMethod(); ```</p>
<h2>Why fast</h2>
<p>RouteKit gains performance in two ways: better data structure for rule-matching, and ability to convert dynamic call to static call.</p>
<h3>Matching process</h3>
<p>RouteKit store routing rules in tree structure, so the matching speed will not be affected by how many rules you have. In other words, the matching process has constant time complexity.</p>
<p>More further, in generated custom router class, we use a Finite State Machine to do the matching process, eliminates all possible function calls. Function calls are much slower comparing to opcode actions (<code>if</code>, <code>switch</code>, assignments, arithmatic operations, etc.) and hashtable manuplating. In practice, the FSM approach can run more than 20x faster comparing to array implementations.</p>
<h3>Static call</h3>
<p>Most of router implementations split the dispatching work into two pieces: matching with rules, and execute the correct handler/controller. The matching part returns a callback, which is the handler/controller, and some other data. The execution part can call to that callback later, with <code>call_user_func</code> or <code>call_user_func_array</code>. And cufa is notorious for its <b>great</b> performance.</p>
<p>By generating custom router class, we generate codes according to the information you provided in routing rules. No more cufa, no more reflection, so no more performance penalty.</p>
<h2>Diagram</h2>
<p>RouteKit can generate diagram to describe how we match the rules:</p>
<p>```php $mux = new <a class="el" href="namespace_fruit.html">Fruit</a>;</p>
<p>// add rules here $mux-&gt;get('/', 'my_handler');</p>
<p>$diagrams = $mux-&gt;dot(); file_put_contents('get.gv', $diagrams['get']); ```</p>
<p>then</p>
<p>```sh dot -Tsvg get.gv &gt; get.svg ```</p>
<h2>Type converting for PHP7</h2>
<p>You can add type hintings to your handler if you are using PHP7, RouteKit will automatically do the type checking and converting for you. Currently we support only <code>int</code>, <code>float</code>, <code>bool</code> and <code>string</code> types. We will not check/convert the parameters without type-hinted.</p>
<p>In non-compiled version, this is done by <code>ReflectionParameter::getType()</code>, so it would costs some performance.</p>
<p>In compiled version, we grab the type info at compile time, so there is no performance penalty excepts the type checking and converting works.</p>
<p>```php function handlerOK(int $i) {} function handlerFAIL(array $i) {} $mux-&gt;get('/ok/:', 'handlerOK'); $mux-&gt;get('/fail/:', 'handlerFAIL');</p>
<p>$mux-&gt;dispatch('GET', '/ok/1'); // works $mux-&gt;dispatch('GET', '/ok/hello'); // throw a <a class="el" href="namespace_fruit.html">Fruit</a> $mux-&gt;dispatch('GET', '/fail/1'); // throw an Exception with messages telling you array type is not supported $mux-&gt;compile(); // throw an Exception with messages telling you array type is not supported ```</p>
<h2>License</h2>
<p>Any version of MIT, GPL or LGPL. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jan 25 2016 15:06:40 for Fruit RouteKit by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
